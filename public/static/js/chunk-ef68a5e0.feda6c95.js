(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef68a5e0"],{"0bd9":function(t,e,o){"use strict";o("935a")},"1d06":function(t,e,o){},"8ba6":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("article-detail",{attrs:{"is-edit":!0}})},a=[],s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"createPost-container"},[o("el-form",{ref:"postForm",staticClass:"form-container",attrs:{model:t.postForm,rules:t.rules}},[o("sticky",{attrs:{"z-index":10,"class-name":"sub-navbar "+t.postForm.status}},[o("div",{staticClass:"stick"},[o("PlatformDropdown",{model:{value:t.postForm.platforms,callback:function(e){t.$set(t.postForm,"platforms",e)},expression:"postForm.platforms"}}),o("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-left":"10px"},attrs:{type:"success",icon:"el-icon-s-promotion",plain:""},on:{click:t.submitForm}},[t._v("发布")]),o("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"warning",icon:"el-icon-document-checked",plain:""},on:{click:t.draftForm}},[t._v("存为草稿")]),o("el-autocomplete",{staticStyle:{"margin-left":"10px",width:"150px"},attrs:{clearable:"","prefix-icon":"el-icon-folder-opened","fetch-suggestions":t.querySearchAsync,placeholder:"草稿箱("+t.draftNums+")"},on:{select:t.handleSelect},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}})],1)]),o("div",{staticClass:"createPost-main-container"},[o("el-row",[o("Warning"),o("el-col",{attrs:{span:24}},[o("el-form-item",{staticStyle:{"margin-bottom":"40px"},attrs:{prop:"title",name:"name",required:""}},[o("MDinput",{attrs:{maxlength:100},model:{value:t.postForm.title,callback:function(e){t.$set(t.postForm,"title",e)},expression:"postForm.title"}},[t._v("新闻标题")])],1),o("div",{staticClass:"postInfo-container"},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"40px",label:"作者"}},[o("el-select",{attrs:{loading:t.select_loading,"remote-method":t.getRemoteUserList,filterable:"","default-first-option":"",remote:"",placeholder:"搜索作者"},model:{value:t.postForm.author,callback:function(e){t.$set(t.postForm,"author",e)},expression:"postForm.author"}},t._l(t.userListOptions,(function(t,e){return o("el-option",{key:t+e,attrs:{label:t,value:t}})})),1)],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"90px",label:"发布时间"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:t.postForm.display_time,callback:function(e){t.$set(t.postForm,"display_time",e)},expression:"postForm.display_time"}})],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"90px",label:"新闻类别"}},[o("el-select",{attrs:{loading:t.select_loading,"remote-method":t.getRemoteCategoryList,filterable:"","default-first-option":"",remote:"",placeholder:"搜索新闻类别"},model:{value:t.postForm.category,callback:function(e){t.$set(t.postForm,"category",e)},expression:"postForm.category"}},t._l(t.categoryListOptions,(function(t,e){return o("el-option",{key:t+e,attrs:{label:t,value:t}})})),1)],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"90px",label:"所属部门"}},[o("el-select",{attrs:{loading:t.select_loading,"remote-method":t.getRemoteDeptList,filterable:"","default-first-option":"",remote:"",placeholder:"搜索部门"},model:{value:t.postForm.deptName,callback:function(e){t.$set(t.postForm,"deptName",e)},expression:"postForm.deptName"}},t._l(t.deptListOptions,(function(t,e){return o("el-option",{key:t+e,attrs:{label:t,value:t}})})),1)],1)],1)],1)],1)],1)],1),o("el-form-item",{staticStyle:{"margin-bottom":"30px"},attrs:{prop:"content"}},[o("Tinymce",{ref:"editor",attrs:{height:400},model:{value:t.postForm.content,callback:function(e){t.$set(t.postForm,"content",e)},expression:"postForm.content"}})],1)],1)],1)],1)},r=[],n=(o("d81d"),o("4de4"),o("b0c0"),o("8256")),l=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"upload-container"},[o("el-upload",{staticClass:"image-uploader",attrs:{data:t.dataObj,multiple:!1,"show-file-list":!1,"on-success":t.handleImageSuccess,drag:"",action:"https://httpbin.org/post"}},[o("i",{staticClass:"el-icon-upload"}),o("div",{staticClass:"el-upload__text"},[t._v(" 将文件拖到此处，或"),o("em",[t._v("点击上传")])])]),o("div",{staticClass:"image-preview image-app-preview"},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.imageUrl.length>1,expression:"imageUrl.length>1"}],staticClass:"image-preview-wrapper"},[o("img",{attrs:{src:t.imageUrl}}),o("div",{staticClass:"image-preview-action"},[o("i",{staticClass:"el-icon-delete",on:{click:t.rmImage}})])])]),o("div",{staticClass:"image-preview"},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.imageUrl.length>1,expression:"imageUrl.length>1"}],staticClass:"image-preview-wrapper"},[o("img",{attrs:{src:t.imageUrl}}),o("div",{staticClass:"image-preview-action"},[o("i",{staticClass:"el-icon-delete",on:{click:t.rmImage}})])])])],1)},c=[],m=(o("d3b7"),o("b775"));function p(){return Object(m["a"])({url:"/qiniu/upload/token",method:"get"})}var u={name:"SingleImageUpload3",props:{value:{type:String,default:""}},data:function(){return{tempUrl:"",dataObj:{token:"",key:""}}},computed:{imageUrl:function(){return this.value}},methods:{rmImage:function(){this.emitInput("")},emitInput:function(t){this.$emit("input",t)},handleImageSuccess:function(t){this.emitInput(t.files.file)},beforeUpload:function(){var t=this,e=this;return new Promise((function(o,i){p().then((function(i){var a=i.data.qiniu_key,s=i.data.qiniu_token;e._data.dataObj.token=s,e._data.dataObj.key=a,t.tempUrl=i.data.qiniu_url,o(!0)})).catch((function(t){console.log(t),i(!1)}))}))}}},d=u,f=(o("0bd9"),o("2877")),g=Object(f["a"])(d,l,c,!1,null,"0e0b11b7",null),h=g.exports,v=o("1aba"),F=o("b804"),b=o("3ee8"),y=o("3df4"),w=o("0c37"),_={loginuserCode:"",author:"",status:"draft",title:"",content:"",image_uri:"",display_time:void 0,id:0,platforms:["院内网站"],category:"",deptName:"",type:"",role:"",newsStatus:void 0},x={name:"ArticleDetail",components:{Tinymce:n["a"],MDinput:v["a"],Upload:h,Sticky:F["a"],Warning:y["a"],CommentDropdown:w["a"],PlatformDropdown:w["b"],SourceUrlDropdown:w["c"]},props:{isEdit:{type:Boolean,default:!1}},data:function(){var t=this,e=function(e,o,i){""===o?(t.$message({message:e.field+"为必传项",type:"error"}),i(new Error(e.field+"为必传项"))):i()};return{draftTitleList:[],draftNums:0,state:"",timeout:null,select_loading:!1,postForm:Object.assign({},_),loading:!1,userListOptions:[],categoryListOptions:[],deptListOptions:[],rules:{image_uri:[{validator:e}],title:[{validator:e}],content:[{validator:e}]},tempRoute:{}}},computed:{displayTime:{get:function(){return+new Date(this.postForm.display_time)},set:function(t){this.postForm.display_time=new Date(t)}}},created:function(){if(this.getdraftTitleList(),this.isEdit){var t=this.$route.params&&this.$route.params.id;this.fetchData(t)}this.tempRoute=Object.assign({},this.$route)},methods:{fetchData:function(t){var e=this,o={id:t};Object(b["d"])(o).then((function(t){var o=t.result;e.postForm.id=o.id,e.postForm.title=o.title,e.postForm.content=o.content,e.postForm.display_time=o.createTime,e.postForm.category=o.category,e.postForm.author=o.userName,e.postForm.deptName=o.deptName,e.postForm.status=o.status,e.setTagsViewTitle(),e.setPageTitle()})).catch((function(t){console.log(t)}))},setTagsViewTitle:function(){var t="Edit Article",e=Object.assign({},this.tempRoute,{title:"".concat(t,"-").concat(this.postForm.id)});this.$store.dispatch("tagsView/updateVisitedView",e)},setPageTitle:function(){var t="Edit Article";document.title="".concat(t," - ").concat(this.postForm.id)},submitForm:function(){var t=this;0!==this.postForm.content.length&&0!==this.postForm.title.length?""!==this.postForm.author&&""!==this.postForm.deptName&&""!==this.postForm.category?this.$refs.postForm.validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$confirm("是否发布文章?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.postForm.status="published",t.loading=!0,t.postForm.loginuserCode=localStorage.getItem("userCode"),t.postForm.type=2,t.postForm.newsStatus=2,t.postForm.role=localStorage.getItem("role"),Object(b["g"])(t.postForm).then((function(){t.$notify({title:"成功",message:"发布成功",type:"success",duration:2e3}),t.getdraftTitleList(),t.loading=!1}))}))})):this.$message({message:"请填写作者相关信息",type:"warning"}):this.$message({message:"请填写必要的标题和内容",type:"warning"})},getdraftTitleList:function(){var t=this,e={role:localStorage.getItem("role"),loginuserCode:localStorage.getItem("userCode")};Object(b["e"])(e).then((function(e){var o=e.items;t.draftTitleList=o.map((function(t){return{value:t.title,id:t.id}})),t.draftNums=o.length}))},handleSelect:function(t){var e=this,o={id:t.id};Object(b["d"])(o).then((function(t){var o=t.result;e.postForm.id=o.id,e.postForm.title=o.title,e.postForm.content=o.content,e.postForm.display_time=o.createTime,e.postForm.category=o.category,e.postForm.author=o.userName,e.postForm.deptName=o.deptName}))},draftForm:function(){var t=this;this.postForm.loginuserCode=localStorage.getItem("userCode"),this.postForm.role=localStorage.getItem("role"),this.postForm.newsStatus=4,this.postForm.type=1,this.$confirm("是否存为草稿?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(b["h"])(t.postForm).then((function(e){t.getdraftTitleList(),t.$notify({message:"已经保存为草稿",type:"success",showClose:!0,duration:2e3}),t.postForm.status="draft",t.loading=!1,t.resetPostForm(),console.log(t.postForm)}))}))},querySearchAsync:function(t,e){var o=this.draftTitleList;this.draftNums=this.draftTitleList.length;var i=t?o.filter(this.createStateFilter(t)):o;clearTimeout(this.timeout),this.timeout=setTimeout((function(){e(i)}),2e3)},createStateFilter:function(t){return function(e){return 0===e.value.indexOf(t.toLowerCase())}},getRemoteUserList:function(t){var e=this;Object(b["k"])(t).then((function(t){var o=t.items;o&&(e.userListOptions=o.map((function(t){return t.username})))}))},getRemoteCategoryList:function(t){var e=this;Object(b["i"])(t).then((function(t){var o=t.items;o&&(e.categoryListOptions=o.map((function(t){return t.name})))}))},getRemoteDeptList:function(t){var e=this;Object(b["j"])(t).then((function(t){var o=t.items;o&&(e.deptListOptions=o.map((function(t){return t.name})))}))}}},C=x,k=(o("cc2a"),Object(f["a"])(C,s,r,!1,null,"4e6c895e",null)),O=k.exports,S={name:"EditForm",components:{ArticleDetail:O}},T=S,L=Object(f["a"])(T,i,a,!1,null,null,null);e["default"]=L.exports},"935a":function(t,e,o){},cc2a:function(t,e,o){"use strict";o("1d06")}}]);